function getUrlVars(){for(var i,e=[],o=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),n=0;n<o.length;n++)i=o[n].split("="),e.push(i[0]),e[i[0]]=i[1];return e}$(document).ready(function(){function e(){}function o(i){return i.addClass("on"),q.userdata={postdate:new Date,userword:$(".user_word").val(),username:$(".user_name").val(),userphone:$(".user_phone").val(),useremail:$(".user_email").val()},q.userdata.userword&&q.userdata.username&&q.userdata.userphone&&q.userdata.useremail?(k(!0),void $.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/emailbox1?apiKey="+q.mlabApikey,type:"POST",contentType:"application/json",data:JSON.stringify(q.userdata),success:function(e){n(),alert("我們已收到您的意見，將由專人盡快回覆處理，謝謝你。"),i.removeClass("on"),k(!1)},error:function(e,o,n){i.removeClass("on"),k(!1),console.log("error:",e,o,n)}})):(alert("請填寫完整資料"),void i.removeClass("on"))}function n(){$(".user_word").val(""),$(".user_name").val(""),$(".user_phone").val(""),$(".user_email").val("")}function a(i){$(".contact_boxin .addr").html(i[0].addr),2==getUrlVars().page&&$("body,html").animate({scrollTop:$(".pg2").offset().top-50},0),k(!1)}function s(e){$(".about_boxin").html('<div class="title">'+e[0].title+'</div><div class="cover"><img src="'+e[0].cover+'" alt=""></div><div class="info">'+e[0].info+'</div><div class="teacher"><div class="t">專業師資</div><div class="box"></div></div>');for(i in e[0].list)$(".teacher .box").append('<div class="per"><div class="pic"><img src="'+e[0].list[i].pic+'"></div><div class="name">'+e[0].list[i].name+'</div><div class="w">'+e[0].list[i].des+"</div></div>");$(".sec_menu a").eq(q.nowpage-1).addClass("on"),k(!1)}function t(e){e=e.reverse(),$(".link_boxin").html("");for(i in e)$(".link_boxin").append('<a href="'+e[i].link+'" class="n" target="_blank"><img src="'+e[i].pic+'"></a>');k(!1)}function l(e){e=e.reverse(),$(".award_boxin").html("");for(i in e){$(".award_boxin").append('<div class="award_list"><div class="title">'+e[i].title+'</div><ul><li class="t"><div class="lt">姓名</div><div class="rt">獎項</div></li></ul></div>');for(j in e[i].list)$(".award_boxin .award_list").eq(i).find("ul").append('<li><div class="lt">'+e[i].list[j].name+'</div><div class="rt">'+e[i].list[j].word+"</div></li>")}k(!1)}function p(i){$(".learn_boxin .title").eq(0).html(i[0].title),$(".learn_boxin .main").html('<div class="lt paperpic"><div class="pic photoimg"><div class="icon learnicon"></div><img src="'+i[0].photo+'"></div></div><div class="rt"><div class="t">【課程資訊】</div><div class="w">'+i[0].classinfo+'</div><div class="t">【課表說明】</div><div class="w">'+i[0].classdes+"</div></div>"),$(".sec_menu a").eq(q.nowpage-1).addClass("on"),$(".learnicon").click(function(){u(!0,$(this).parent().find("img").attr("src"),"paperpic",$(this).parent().index())}),k(!1)}function c(e){$(".learn_boxin .photo").html("");for(i in e)$(".learn_boxin .photo").prepend('<div class="pic photoimg"><img src="'+e[i].pic+'" alt=""></div>');$(".learn_box .photo .pic").click(function(){u(!0,$(this).find("img").attr("src"),"photo",$(this).index())}),k(!1)}function r(e){$(".news_content_boxin").html("");var o=getUrlVars().id;o||(alert("沒有該則消息"),_("news.html?page=1"));var n=!0;for(i in e)e[i]._id.$oid==o&&(n=!1,$(".news_content_boxin").html('<div class="title">'+e[i].title+'</div><div class="date">'+e[i].date+'</div><div class="pic"><img src="'+e[i].bpic+'"></div><div class="w">'+e[i].bword+"</div>"));n&&(alert("沒有該則消息"),_("news.html?page=1")),4==q.nowpage?$(".sec_menu .back").attr("href","index.html?newspage=1"):$(".sec_menu .back").attr("href","news.html?page="+q.nowpage),k(!1)}function d(e){e=e.reverse(),$(".news_boxin").html("");for(i in e)$(".news_boxin").append('<a href="news_content.html?id='+e[i]._id.$oid+"&page="+q.nowpage+'" class="n"><div class="pic"><div class="picin"><img src="'+e[i].spic+'"></div></div><div class="t">'+e[i].title+'</div><div class="w">'+e[i].sword+'</div><div class="date">'+e[i].date+'</div><div class="more">觀看更多</div></a>');$(".sec_menu a").eq(q.nowpage-1).addClass("on"),k(!1)}function h(e,o){if(e&&(e.collectname=o,q.indexphoto.push(e)),q.indexcomplete+=1,console.log(q.indexcomplete),7==q.indexcomplete){console.log("complete");for(i in q.indexphoto)if("index_banner"==q.indexphoto[i].collectname){$(".banner .swiper-wrapper").html("");for(var n=0;n<q.indexphoto[i].length;n++)$(".banner .swiper-wrapper").append('<div class="swiper-slide"><a href="javascript:;"><img src="'+q.indexphoto[i][n].pic+'"></a></div>')}else if("index_photo"==q.indexphoto[i].collectname){$(".photo_video .swiper-wrapper").html("");for(var n=0;n<q.indexphoto[i].length;n++)$(".photo_video .swiper-wrapper").append('<div class="swiper-slide photoimg"><a href="javascript:;"><img src="'+q.indexphoto[i][n].pic+'" alt=""></a></div>')}else if("index_video"==q.indexphoto[i].collectname){var a=q.indexphoto[i][0].video.split("v=")[1];$(".photo_video .video").html('<dvi class="t">相關影音</dvi><iframe width="100" height="100" src="https://www.youtube.com/embed/'+a+'" frameborder="0" allowfullscreen></iframe>')}$(".news .boxall .box").html(""),$(".paper .paperin").html("");for(i in q.indexNews)if(4!=q.indexNews[i].collections)for(var n=0;n<q.indexNews[i].length;n++)$(".news .boxall .box").eq(1*q.indexNews[i].collections-1).append('<a href="news_content.html?id='+q.indexNews[i][n]._id.$oid+"&page="+q.indexNews[i].collections+'" class="n"><div class="pic"><div class="picin"><img src="'+q.indexNews[i][n].spic+'" alt=""></div></div><div class="t">'+q.indexNews[i][n].title+'</div><div class="w">'+q.indexNews[i][n].sword+'</div><div class="date">'+q.indexNews[i][n].date+'</div><div class="more">觀看更多</div></a>');else for(var n=0;n<q.indexNews[i].length;n++)$(".paper .paperin").append('<a href="news_content.html?id='+q.indexNews[i][n]._id.$oid+"&page="+q.indexNews[i].collections+'" class="n"><div class="t">'+q.indexNews[i][n].title+'</div><div class="w">'+q.indexNews[i][n].sword+'</div><div class="date">'+q.indexNews[i][n].date+"</div></a>");q.banner_swiper=new Swiper(".banner_container",{speed:1e3,wrapperClass:"swiper-wrapper",slideClass:"swiper-slide",slidesPerView:1,pagination:".banner-pagination",paginationClickable:!0,spaceBetween:0,loop:!0,autoplay:6e3,autoplayDisableOnInteraction:!1}),q.photo_swiper=new Swiper(".photo_container",{speed:500,wrapperClass:"swiper-wrapper",slideClass:"swiper-slide",slidesPerView:1,spaceBetween:0,loop:!0,autoplay:4e3,autoplayDisableOnInteraction:!1}),m(),g(0),getUrlVars().newspage&&$("html,body").animate({scrollTop:$(".paper").offset().top-50},0),k(!1),$(".photo_video .photo a").click(function(){u(!0,$(this).find("img").attr("src"),"photo_video",$(this).parent().index())})}}function w(){q.indexcomplete=0,q.indexphoto=[],q.indexNews=[];for(var i=1;5>i;i++)v(i);y("index_banner",h),y("index_photo",h),y("index_video",h)}function v(i){$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/news_page"+i+'?s={"_id":-1}&l=3&apiKey='+q.mlabApikey,type:"GET",contentType:"application/json",success:function(e){e.collections=i,q.indexNews.push(e),h()},error:function(i,e,o){console.log("error:",i,e,o)}})}function m(){for(var i=0;i<$(".banner .swiper-slide").length;i++){var e=($(window).width()-$(".banner .swiper-slide").eq(i).find("img").width())/2;0>e&&$(".banner .swiper-slide").eq(i).find("img").css("margin-left",e)}}function u(i,e,o,n){i?(q.nowphotopop=$("."+o),q.nowphotopopnum=n,q.nowphotopop.find(".photoimg").length<2?$(".photo_pop .ctrl").hide():$(".photo_pop .ctrl").show(),$(".photo_pop").fadeIn(300,function(){$(".photo_pop .photo").addClass("on")}),$(".photo_pop .photo img").attr("src",e)):$(".photo_pop").fadeOut(300,function(){$(".photo_pop .photo").removeClass("on")})}function f(i){"next"==i?q.nowphotopopnum+=1:"prev"==i&&(q.nowphotopopnum-=1),q.nowphotopopnum>q.nowphotopop.find(".photoimg").length-1?q.nowphotopopnum=0:q.nowphotopopnum<0&&q.nowphotopop.find(".photoimg").length-1;var e=q.nowphotopop.find(".photoimg").eq(q.nowphotopopnum).find("img").attr("src");$(".photo_pop .photo img").attr("src",e)}function g(i){$(".newsbar li").removeClass("on").eq(i).addClass("on"),$(".news .boxall .box").removeClass("on").eq(i).addClass("on")}function b(i){0==i?_("about.html?page=1"):1==i?_("news.html?page=1"):2==i?_("learn.html?page=1"):3==i?_("award.html"):4==i?_("link.html"):5==i?_("contact.html?page=1"):6==i&&_("contact.html?page=2")}function _(i){window.location.href=i}function x(){window.pageYOffset>0?$(".gotopbtn").fadeIn():$(".gotopbtn").fadeOut()}function k(i){i?$(".loading").fadeIn(1e3):$(".loading").fadeOut(1e3)}function C(){q.wrp.hasClass("index")&&m()}function y(i,e){$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/"+i+q.nowpage+'?s={"_id":-1}&apiKey='+q.mlabApikey,type:"GET",contentType:"application/json",success:function(o){e(o,i)},error:function(i,e,o){console.log("error:",i,e,o)}})}function N(i,e){$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/"+i+q.nowpage+"?apiKey="+q.mlabApikey,type:"GET",contentType:"application/json",success:function(i){e(i)},error:function(i,e,o){console.log("error:",i,e,o)}})}var q={};q.wrp=$(".wrapper"),q.mlabApikey="n6FXodWWCdM14KrePZHrRPPovbzboRn6",q.nowpage=getUrlVars().page,q.nowpage||(q.nowpage=1),q.wrp.hasClass("index")&&w(),q.wrp.hasClass("news")&&N("news_page",d),q.wrp.hasClass("news_content")&&N("news_page",r),q.wrp.hasClass("learn")&&(N("learning_page",p),N("learning_photo_page",c)),q.wrp.hasClass("award")&&N("awards",l),q.wrp.hasClass("link")&&N("otherlink",t),q.wrp.hasClass("about")&&N("aboutus_page",s),q.wrp.hasClass("contact")&&(q.nowpage=1,N("contactus",a)),$(".contact_box .user_btn").click(function(){$(this).hasClass("on")||o($(this))}),$(".photo_pop .rightbtn").click(function(){f("next")}),$(".photo_pop .leftbtn").click(function(){f("prev")}),$(".photo_pop .closebtn").click(function(){u(!1)}),$(".photo_pop .cover").click(function(){u(!1)}),$(".newsbar li").click(function(){g($(this).index())}),$(".menua").click(function(){b($(this).index())}),$(".gotopbtn").click(function(){$("html,body").animate({scrollTop:0},500)}),$(".banner .leftbtn").click(function(){q.banner_swiper.slidePrev()}),$(".banner .rightbtn").click(function(){q.banner_swiper.slideNext()}),$(".photo .leftbtn").click(function(){q.photo_swiper.slidePrev()}),$(".photo .rightbtn").click(function(){q.photo_swiper.slideNext()}),$(".top .logo").click(function(){_("index.html")}),window.onscroll=x,$(window).load(function(){e()}),$(window).resize(function(){C()})});